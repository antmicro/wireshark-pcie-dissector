# Wireshark plugin for PCIe

Copyright (c) 2023 [Antmicro](https://www.antmicro.com)

Copyright (c) 2023 Meta

A wireshark dissector plugin for PCIe packets (TLP & DLLP).
Being just a dissector for a simple wrapper protocol transmitting PCIe packets over TCP it **does not** allow PCIe *capture* from an actual physical bus on your host operating system.
The protocol implemented kind of resembles the physical layer of PCIe, with a `\x02` byte introducing a DLLP and `\x03` introducing a TLP wrapped in data-link layer seqno and LCRC.

# Installing

Just copy (or link) the plugin into your `~/.config/wireshark/plugins` (the directory might not exist yet).
<!-- name="install" -->
```sh
mkdir -p ~/.config/wireshark/plugins
cp *.lua ~/.config/wireshark/plugins
```

# Example

Sample packet dump generated by hand can be found in [sample.pcapng](./sample.pcapng).

You can open it in wireshark, or see some basic info in the terminal with tshark:
<!-- name="test" -->
```sh
tshark -r sample.pcapng pcie
```

If the plugin is installed correctly, you should see the following output:
<!-- name="gold" -->
```
    4 0.000114094          ::1 → ::1          PCIe/IP 93 dllp
    6 0.000140261          ::1 → ::1          PCIe/IP 105 MRd  00:00.0 @ 00000000
    8 0.000155321          ::1 → ::1          PCIe/IP 93 dllp
   10 0.040365125          ::1 → ::1          PCIe/IP 4201 CplD 00:01.0 -> 00:00.0
   12 0.040394209          ::1 → ::1          PCIe/IP 93 dllp
```

